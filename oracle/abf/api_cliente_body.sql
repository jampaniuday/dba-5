SQL> /
PACKAGE BODY      b2w_api_cliente IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ** MJV Informática                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ** B2W / Projeto Fusion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  **                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ** GAP 374                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  ** PACKAGE PARA CADASTRAR/ATUALIZAR CLIENTES NO AR                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ** POR: MARCOS COSTA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  ** ALTERADO 21/08/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  ** iNCLUIR DATA DE CRIAÇÃO DO CLLENTE NO SITE                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  ** cORRECAO DA DERIVAÇAO DO CNPJ NA PROCEDURE INSERE_ENDERECO                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  **                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ** Alteracao no retorno de erro:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  ** Alterado de "E" para "W" a pedido Luciana(MJV) em 16/02/2009-Adilson Hentzy                                                                                                                                                                                                                                                                                                                                                                                                                                    
  */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- INSERIR NOVOS ENDEREÇOS PARA O CLIENTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  p_create_profile_amt   VARCHAR2(1) := fnd_api.g_true;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  p_create_profile       VARCHAR2(1) := fnd_api.g_true;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  x_contact_point_id     NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_site_use_id          NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_cust_acct_site_id    NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_party_site_id        NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_party_site_number    VARCHAR2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  x_location_id          NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_cust_account_id      NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_account_number       VARCHAR2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  x_party_id             NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_party_number         VARCHAR2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  x_profile_id           NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_return_status        VARCHAR2(1);                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  x_msg_count            NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  x_msg_data             VARCHAR2(2000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  v_customer_id          ra_customers.customer_id%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  v_party_id             NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  v_cust_account_id      NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  v_cust_acct_site_id    NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  l_msg_data_out         VARCHAR2(3000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  l_location_rec         hz_location_v2pub.location_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  l_party_site_rec       hz_party_site_v2pub.party_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  l_cust_site_use_rec    hz_cust_account_site_v2pub.cust_site_use_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                         
  p_customer_profile_rec hz_customer_profile_v2pub.customer_profile_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                       
  l_cust_acct_site_rec   hz_cust_account_site_v2pub.cust_acct_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                        
  --  ABAIXO NOVAS DECLARACOES - LEANDRO/FC 02/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  l_person_rec           hz_party_v2pub.person_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  l_organization_rec     hz_party_v2pub.organization_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  l_cust_account_rec     hz_cust_account_v2pub.cust_account_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                               
  l_customer_profile_rec hz_customer_profile_v2pub.customer_profile_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                       
  l_contact_point_rec    hz_contact_point_v2pub.contact_point_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                             
  l_email_rec            hz_contact_point_v2pub.email_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  l_phone_rec            hz_contact_point_v2pub.phone_rec_type := hz_contact_point_v2pub.g_miss_phone_rec;                                                                                                                                                                                                                                                                                                                                                                                                          
  l_edi_rec              hz_contact_point_v2pub.edi_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  l_telex_rec            hz_contact_point_v2pub.telex_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  l_web_rec              hz_contact_point_v2pub.web_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  p_cliente              b2wcustomer.customer;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  p_id_cliente           hz_cust_accounts_all.orig_system_reference%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- INSERE ENDEREÇO                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE b2w_insere_endereco                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    x_desc_erro OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,x_cod_erro  OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,p_endereco  IN b2wcustomer.address_tbl                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
   ,p_usuario   IN VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  ) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    p_create_profile_amt   VARCHAR2(1) := fnd_api.g_true;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    p_create_profile       VARCHAR2(1) := fnd_api.g_true;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    x_site_use_id          NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_cust_acct_site_id    NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_party_site_id        NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_party_site_number    VARCHAR2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    x_location_id          NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_return_status        VARCHAR2(1);                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    x_msg_count            NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_msg_data             VARCHAR2(2000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    v_customer_id          ra_customers.customer_id%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    v_party_id             NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_cust_account_id      NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    l_msg_data_out         VARCHAR2(3000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    l_location_rec         hz_location_v2pub.location_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    l_party_site_rec       hz_party_site_v2pub.party_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    l_cust_site_use_rec    hz_cust_account_site_v2pub.cust_site_use_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                       
    p_customer_profile_rec hz_customer_profile_v2pub.customer_profile_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                     
    l_cust_acct_site_rec   hz_cust_account_site_v2pub.cust_acct_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --  ABAIXO NOVAS DECLARACOES - LEANDRO/FC 02/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    l_cpf          ra_customers.global_attribute3%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    l_contribuinte ra_addresses.global_attribute8%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    l_tipo_cliente ra_customers.party_type%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- FIM NOVAS DECLARACOES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    b2w_set_apps_initialize.b2w_set_apps_initialize('OM', '');                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Endereço                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    FOR i IN 1 .. p_endereco.COUNT LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      /*IF p_endereco(i).SITEADDRESSID IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            'b2w_api_cliente.b2w_insere_endereco, Identificador imutável do endereço no site está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                           
         RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      IF p_endereco(i).addressid IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_endereco, Identificador do endereço do cliente no site está nulo.';                                                                                                                                                                                                                                                                                                                                                                                              
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_endereco(i).address IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_endereco, Endereço do cliente está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                       
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /*IF p_endereco (i).number_p IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            'b2w_api_cliente.b2w_insere_endereco, Nr. do endereço do cliente está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                           
         RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /*IF p_endereco (i).additionalinfo IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
               THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                  x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                  x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                     'b2w_api_cliente.b2w_insere_endereco, Informações adicionais do endereço do cliente está nulo.';                                                                                                                                                                                                                                                                                                                                                                                               
                  RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
               END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      /*IF p_endereco (i).quarter IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                  'b2w_api_cliente.b2w_insere_endereco, Bairro está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                         
         RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_endereco(i).city IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_endereco, Cidade está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                    
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_endereco(i).state IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_endereco, Estado está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                    
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_endereco(i).country IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_endereco, País está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                      
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_endereco(i).postalcode IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_endereco, CEP está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                       
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      /*IF p_endereco (i).creationdate IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            'b2w_api_cliente.b2w_insere_endereco, Data de criação do endereço está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                          
         RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Verificar se o cliente já existe                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    p_id_cliente := p_endereco(1).customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF p_id_cliente IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
              ,attribute2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
              ,party_type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
          INTO v_customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
              ,l_cpf                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
              ,l_tipo_cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          FROM ra_customers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         WHERE orig_system_reference = p_id_cliente;                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN no_data_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'B2W_API_CLIENTE.b2w_insere_endereco' || ' - ' || to_char(SYSDATE, 'dd-mm-yyyy hh24:mi:ss') ||                                                                                                                                                                                                                                                                                                                                                                                             
                         ' - não encontrou a busca na tabela ra_customers.' || ' - ' || utl_http.get_detailed_sqlerrm;                                                                                                                                                                                                                                                                                                                                                                                              
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT global_attribute8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          INTO l_contribuinte                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          FROM ra_addresses_all                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
         WHERE customer_id = v_customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
           AND rownum = 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN no_data_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'B2W_API_CLIENTE.b2w_insere_endereco' || ' - ' || to_char(SYSDATE, 'dd-mm-yyyy hh24:mi:ss') ||                                                                                                                                                                                                                                                                                                                                                                                             
                         ' - não encontrou a busca na tabela ra_addresses.' || ' - ' || utl_http.get_detailed_sqlerrm;                                                                                                                                                                                                                                                                                                                                                                                              
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          IF l_tipo_cliente <> 'PERSON'                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
          THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                'Cliente informado não é uma pessoa física, novo endereço não pode ser adicionado.';                                                                                                                                                                                                                                                                                                                                                                                                                
             RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- D1 - Pegar os campos party_id e cust_account_id                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      SELECT party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            ,cust_account_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        INTO v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            ,v_cust_account_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
        FROM hz_cust_accounts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHERE orig_system_reference = p_id_cliente; --v_customer_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      WHEN no_data_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'B2W_API_CLIENTE.b2w_insere_endereco' || ' - ' || to_char(SYSDATE, 'dd-mm-yyyy hh24:mi:ss') ||                                                                                                                                                                                                                                                                                                                                                                                               
                       ' - não encontrou a busca na tabela hz_cust_accounts.' || ' - ' || utl_http.get_detailed_sqlerrm;                                                                                                                                                                                                                                                                                                                                                                                            
        --            UTL_HTTP.end_response (v_http_response);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    FOR i IN 1 .. p_endereco.COUNT LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      DECLARE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        l_endereco_existe NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT COUNT(1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
          INTO l_endereco_existe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          FROM hz_cust_acct_sites                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
         WHERE orig_system_reference = p_endereco(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        IF l_endereco_existe > 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
          x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Endereço ' || p_endereco(i).addressid || ' já cadastrado';                                                                                                                                                                                                                                                                                                                                                                                            
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_location_rec.orig_system_reference := p_endereco(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                              
      l_location_rec.address1              := p_endereco(i).address;                                                                                                                                                                                                                                                                                                                                                                                                                                                
      l_location_rec.address4              := p_endereco(i).number_p;                                                                                                                                                                                                                                                                                                                                                                                                                                               
      l_location_rec.province              := p_endereco(i).additionalinfo;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_location_rec.address2              := p_endereco(i).quarter;                                                                                                                                                                                                                                                                                                                                                                                                                                                
      l_location_rec.city                  := p_endereco(i).city;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      l_location_rec.state                 := p_endereco(i).state;                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_location_rec.country               := p_endereco(i).country;                                                                                                                                                                                                                                                                                                                                                                                                                                                
      -- FALTAVA ESTE PARAMETRO. CORRIGI. - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_location_rec.address3    := p_endereco(i).country;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      l_location_rec.postal_code := p_endereco(i).postalcode;                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_location_rec.attribute5  := p_endereco(i).reference_p;                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_location_rec.attribute6  := p_endereco(i).contactname;                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_location_rec.attribute8  := to_char(to_date((substr(p_endereco(i).creationdate, 1, 10) || ' ' || substr(p_endereco(i).creationdate, 12, 8)), 'yyyy-mm-dd hh24:mi:ss'), 'dd/mm/yyyy hh24:mi:ss');                                                                                                                                                                                                                                                                                                            
      -- l_location_rec.attribute19 := p_endereco(i).SITEADDRESSID ;                                                                                                                                                                                                                                                                                                                                                                                                                                                
      l_location_rec.created_by_module := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      hz_location_v2pub.create_location(p_init_msg_list => fnd_api.g_true, p_location_rec => l_location_rec, x_location_id => x_location_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        l_msg_data_out := 'Erro ao criar location: ';                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data     := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                            
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_location_v2pub.create_location.' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                             
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      FOR rr IN (SELECT cust_account_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                   FROM hz_cust_accounts                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                  WHERE party_id = v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                    FOR UPDATE) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      FOR rr IN (SELECT party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                   FROM hz_parties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                  WHERE party_id = v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                    FOR UPDATE) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      FOR rr IN (SELECT party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                   FROM hz_party_sites                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                  WHERE party_id = v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                    FOR UPDATE) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        -- Utilizado para produzir lock na tabela HZ_PARTY_SITES                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      -- chama a procedure para associar Novo endereço ao cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      l_party_site_rec.party_id                 := v_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_party_site_rec.location_id              := x_location_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      l_party_site_rec.identifying_address_flag := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_party_site_rec.created_by_module        := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                              
      l_party_site_rec.status                   := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_party_site_rec.orig_system_reference    := p_endereco(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      hz_party_site_v2pub.create_party_site(p_init_msg_list => fnd_api.g_true, p_party_site_rec => l_party_site_rec, x_party_site_id => x_party_site_id, x_party_site_number => x_party_site_number, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        l_msg_data_out := 'Erro ao criar party_site: ';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data     := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                            
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_party_site_v2pub.create_party_site.' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                         
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_tipo_cliente = 'PERSON' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
        l_cust_acct_site_rec.global_attribute2     := '1';                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.orig_system_reference := p_endereco(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                      
        l_cust_acct_site_rec.global_attribute3     := substr(l_cpf, 0, 9);                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.global_attribute4     := '0000';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        l_cust_acct_site_rec.global_attribute5     := substr(l_cpf, 10, 2);                                                                                                                                                                                                                                                                                                                                                                                                                                         
        l_cust_acct_site_rec.global_attribute8     := l_contribuinte;                                                                                                                                                                                                                                                                                                                                                                                                                                               
        l_cust_acct_site_rec.attribute8            := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.global_attribute9     := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.attribute12           := to_char(to_date((substr(p_endereco(i).creationdate, 1, 10) || ' ' ||                                                                                                                                                                                                                                                                                                                                                                                          
                                                                      substr(p_endereco(i).creationdate, 12, 8)), 'yyyy-mm-dd hh24:mi:ss'), 'dd/mm/yyyy hh24:mi:ss');                                                                                                                                                                                                                                                                                                                                               
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.global_attribute2 := '2';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        l_cust_acct_site_rec.global_attribute3 := substr(l_cpf, 0, 8);                                                                                                                                                                                                                                                                                                                                                                                                                                              
        l_cust_acct_site_rec.global_attribute4 := substr(l_cpf, 9, 4);                                                                                                                                                                                                                                                                                                                                                                                                                                              
        l_cust_acct_site_rec.global_attribute5 := substr(l_cpf, 13, 2);                                                                                                                                                                                                                                                                                                                                                                                                                                             
        l_cust_acct_site_rec.global_attribute8 := l_contribuinte;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        l_cust_acct_site_rec.global_attribute9 := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        l_cust_acct_site_rec.attribute8        := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        l_cust_acct_site_rec.attribute12       := to_char(to_date((substr(p_endereco(i).creationdate, 1, 10) || ' ' ||                                                                                                                                                                                                                                                                                                                                                                                              
                                                                  substr(p_endereco(i).creationdate, 12, 8)), 'yyyy-mm-dd hh24:mi:ss'), 'dd/mm/yyyy hh24:mi:ss');                                                                                                                                                                                                                                                                                                                                                   
        l_cust_acct_site_rec.orig_system_reference := p_endereco(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_cust_acct_site_rec.status                    := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      l_cust_acct_site_rec.created_by_module         := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_cust_acct_site_rec.global_attribute_category := 'JL.BR.ARXCUDCI.Additional';                                                                                                                                                                                                                                                                                                                                                                                                                                
      l_cust_acct_site_rec.attribute1                := 'RES';                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_cust_acct_site_rec.cust_account_id           := v_cust_account_id;                                                                                                                                                                                                                                                                                                                                                                                                                                          
      l_cust_acct_site_rec.party_site_id             := x_party_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_acct_site_rec.LANGUAGE                  := userenv('LANG');                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_acct_site_rec.attribute20               := '0';                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      hz_cust_account_site_v2pub.create_cust_acct_site(p_init_msg_list => fnd_api.g_true, p_cust_acct_site_rec => l_cust_acct_site_rec, x_cust_acct_site_id => x_cust_acct_site_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        l_msg_data_out := 'Erro ao criar cust_acct_site: ';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_site_v2pub.create_cust_acct_site. ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                             
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      ---Complemento de endereço de faturamento                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_site_use_rec.orig_system_reference := p_endereco(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_cust_site_use_rec.cust_acct_site_id     := x_cust_acct_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.site_use_code         := 'BILL_TO';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_cust_site_use_rec.primary_flag          := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.location              := x_location_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      l_cust_site_use_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                              
      hz_cust_account_site_v2pub.create_cust_site_use(p_init_msg_list => fnd_api.g_true, p_cust_site_use_rec => l_cust_site_use_rec, p_customer_profile_rec => p_customer_profile_rec, p_create_profile => p_create_profile, p_create_profile_amt => p_create_profile_amt, x_site_use_id => x_site_use_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        l_msg_data_out := 'Erro ao criar cust_site_use, BILL_TO: ';                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_site_v2pub.create_cust_site_use.' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                               
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      -- Chama a procedure de complemento de endereço de entrega/COBRANCA                                                                                                                                                                                                                                                                                                                                                                                                                                           
      l_cust_site_use_rec.orig_system_reference := p_endereco(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_cust_site_use_rec.cust_acct_site_id     := x_cust_acct_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.site_use_code         := 'SHIP_TO';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_cust_site_use_rec.primary_flag          := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.location              := x_location_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      l_cust_site_use_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                              
      hz_cust_account_site_v2pub.create_cust_site_use(p_init_msg_list => fnd_api.g_true, p_cust_site_use_rec => l_cust_site_use_rec, p_customer_profile_rec => p_customer_profile_rec, p_create_profile => p_create_profile, p_create_profile_amt => p_create_profile_amt, x_site_use_id => x_site_use_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        l_msg_data_out := 'Erro ao criar cust_site_use, SHIP_TO: ';                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_site_v2pub.create_cust_site_use. ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                              
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    x_cod_erro := 'S';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      x_cod_erro  := x_return_status;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      x_desc_erro := 'B2W_API_CLIENTE.b2w_insere_endereco' || x_msg_data || SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                                
      --         UTL_HTTP.end_response (v_http_response);                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  END; -- PROCEDURE INSERE ENDERECO                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  ---- @@@@@@@@@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- ALTERA DADOS DO CLIENTE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE b2w_altera_cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    x_desc_erro OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,x_cod_erro  OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,p_cliente   IN b2wcustomer.customer_tbl                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
   ,p_usuario   IN VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  ) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    x_return_status          VARCHAR2(1);                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    x_msg_count              NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    x_msg_data               VARCHAR2(2000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    l_msg_data_out           VARCHAR2(3000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    v_customer_id            ra_customers.customer_id%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_party_id               NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    v_cust_account_id        NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    v_cust_acct_site_id      NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    v_party_site_id          NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    v_contact_point_id_mail  NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    v_contact_point_id_phone NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    p_object_version_number  NUMBER := 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    ce_object_version_number NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    cp_object_version_number NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    cs_object_version_number NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    l_cust_acct_site_rec     hz_cust_account_site_v2pub.cust_acct_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_account_rec       hz_cust_account_v2pub.cust_account_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                           
    l_contact_point_rec      hz_contact_point_v2pub.contact_point_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                         
    i                        PLS_INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    k                        PLS_INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    l_endereco_tbl           b2wcustomer.address_tbl;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_endereco_rec           b2wcustomer.address;                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    l_cliente_rec            b2wcustomer.customer;                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    p_email_rec              hz_contact_point_v2pub.email_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    p_phone_rec              hz_contact_point_v2pub.phone_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    p_telex_rec              hz_contact_point_v2pub.telex_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    p_web_rec                hz_contact_point_v2pub.web_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    p_edi_rec                hz_contact_point_v2pub.edi_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    l_country                hz_contact_points.phone_country_code%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                             
    l_telefone               hz_contact_points.phone_number%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    l_areacode               hz_contact_points.phone_area_code%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                
    l_ramal                  hz_contact_points.phone_extension%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                
    l_email                  hz_contact_points.email_address%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    b2w_set_apps_initialize.b2w_set_apps_initialize('OM', '');                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    i              := p_cliente.FIRST;                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_endereco_tbl := p_cliente(i).addresslist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    l_cliente_rec  := p_cliente(i);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- V1 - Pegar os campos customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    IF l_cliente_rec.customerid IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
          INTO v_customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FROM ra_customers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         WHERE orig_system_reference = l_cliente_rec.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
          x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Não encontrou a busca na tabela ra_customers.';                                                                                                                                                                                                                                                                                                                                                                                                                                           
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- D1 - Pegar os campos party_id e cust_account_id                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      SELECT party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            ,cust_account_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
            ,object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        INTO v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            ,v_cust_account_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            ,p_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        FROM hz_cust_accounts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHERE cust_account_id = v_customer_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'Não encontrou a busca na tabela hz_cust_accounts. ' || SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                             
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Locar o registro para alteração - Cláudio Velloso - 10/06/2009                                                                                                                                                                                                                                                                                                                                                                                                                                               
    FOR rr IN (SELECT party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                 FROM hz_parties                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                WHERE party_id = v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                  FOR UPDATE) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- D1 - Pegar os campos party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    FOR i IN 1 .. l_endereco_tbl.COUNT LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_endereco_rec := l_endereco_tbl(i);                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          INTO v_party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          FROM hz_party_sites                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
         WHERE orig_system_reference = l_endereco_rec.addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
          x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'B2W_API_CLIENTE.b2w_altera_cliente' || ' - ' || to_char(SYSDATE, 'dd-mm-yyyy hh24:mi:ss') ||                                                                                                                                                                                                                                                                                                                                                                                              
                         'Erro na busca da tabela hz_party_sites. ' || SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                                     
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /*BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
               SELECT party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                 INTO v_party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                 FROM hz_party_sites                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                WHERE orig_system_reference = NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
            EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
               WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
               THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                  x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                  x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                        'B2W_API_CLIENTE.b2w_altera_cliente'                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                     || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                     || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                     || ' - não encontrou a busca na tabela hz_party_sites.';                                                                                                                                                                                                                                                                                                                                                                                                                                       
            END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- D1 - Pegar os campos cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              ,object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          INTO v_cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
              ,cs_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
          FROM hz_cust_acct_sites_all                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
         WHERE party_site_id = v_party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
           AND cust_account_id = v_cust_account_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
          x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'B2W_API_CLIENTE.b2w_altera_cliente' || ' - ' || to_char(SYSDATE, 'dd-mm-yyyy hh24:mi:ss') ||                                                                                                                                                                                                                                                                                                                                                                                              
                         ' - não encontrou a busca na tabela hz_cust_acct_sites_all. ' || SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                  
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT contact_point_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              ,object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          INTO v_contact_point_id_phone                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              ,cp_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
          FROM hz_contact_points                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
         WHERE owner_table_id = v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
           AND owner_table_name = 'HZ_PARTIES'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
           AND contact_point_type = 'PHONE'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
           AND rownum = 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN no_data_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          v_contact_point_id_phone := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- atualiza o cliente - update_cust_acct_site                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_acct_site_rec.cust_acct_site_id := v_cust_acct_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                
      l_cust_acct_site_rec.cust_account_id   := v_cust_account_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_cust_acct_site_rec.party_site_id     := v_party_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_cust_acct_site_rec.attribute20       := '4';                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.istaxpayer IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        l_cust_acct_site_rec.global_attribute8 := l_cliente_rec.istaxpayer;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.stateinscription IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_cust_acct_site_rec.global_attribute6 := l_cliente_rec.stateinscription;                                                                                                                                                                                                                                                                                                                                                                                                                                   
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            l_cust_acct_site_rec.last_update_date := SYSDATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                       
            l_cust_acct_site_rec.last_updated_by := -1;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            l_cust_acct_site_rec.created_by := -1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
            l_cust_acct_site_rec.last_update_login := -1;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- FALTA ASSOCIAR AS DEMAIS COLUNAS NA VARIÁVEL l_cust_acct_site_rec PARA SEREM ALTERADAS - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                
      hz_cust_account_site_v2pub.update_cust_acct_site(p_init_msg_list => fnd_api.g_true, p_cust_acct_site_rec => l_cust_acct_site_rec, p_object_version_number => cs_object_version_number,                                                                                                                                                                                                                                                                                                                        
                                                       -- VARIÁVEL ESTAVA ERRADA. JA CORRIGI - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                   
                                                       x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_site_v2pub.update_cust_acct_site ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                              
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- atualiza o cliente - update_cust_account                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_account_rec.cust_account_id := v_customer_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --Cristiano Carvalho - GPTI - 13-Jul-2009                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      IF l_cliente_rec.email IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        l_cust_account_rec.attribute3 := l_cliente_rec.email;                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.brandinfo.brandid IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_cust_account_rec.attribute5 := l_cliente_rec.brandinfo.brandid;                                                                                                                                                                                                                                                                                                                                                                                                                                           
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /* IF l_cliente_rec.brandinfo.LOCATION IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         l_cust_account_rec.attribute5 := l_cliente_rec.brandinfo.LOCATION;                                                                                                                                                                                                                                                                                                                                                                                                                                         
       END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.gender = 'F' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_cust_account_rec.customer_class_code := 'FEMININO';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF l_cliente_rec.gender = 'M' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
          l_cust_account_rec.customer_class_code := 'MASCULINO';                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_cust_account_rec.customer_class_code := 'OUTROS';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.birthdate IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        l_cust_account_rec.attribute1 := to_char(to_date(substr(l_cliente_rec.birthdate, 1, 10), 'yyyy-mm-dd'), 'dd/mm/yyyy');                                                                                                                                                                                                                                                                                                                                                                                      
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.nickname IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        l_cust_account_rec.attribute6 := l_cliente_rec.nickname;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.relationshiptype IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_cust_account_rec.attribute7 := l_cliente_rec.relationshiptype;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.isblacklisted IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        l_cust_account_rec.attribute8 := l_cliente_rec.isblacklisted;                                                                                                                                                                                                                                                                                                                                                                                                                                               
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --- Incluido por Altair Costa em 23/06/2009                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      IF l_cliente_rec.optlnlist.COUNT > 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        l_cust_account_rec.attribute9 := l_cliente_rec.optlnlist(1).key_s;                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        IF upper(l_cliente_rec.optlnlist(1).enabled) = 'TRUE' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                  
          l_cust_account_rec.attribute10 := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_cust_account_rec.attribute10 := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            l_cust_account_rec.last_update_date := SYSDATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                         
            l_cust_account_rec.last_updated_by := -1;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            l_cust_account_rec.created_by := -1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            l_cust_account_rec.last_update_login := -1;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_account_rec.attribute11 := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_cust_account_rec.attribute19 := '4';                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      hz_cust_account_v2pub.update_cust_account(p_init_msg_list => fnd_api.g_true, p_cust_account_rec => l_cust_account_rec, p_object_version_number => p_object_version_number, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_v2pub.update_cust_account ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                     
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- atualiza o cliente e telefone do cliente - update_contact_point                                                                                                                                                                                                                                                                                                                                                                                                                                            
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      IF l_cliente_rec.nickname IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        l_contact_point_rec.attribute6 := l_cliente_rec.nickname;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.relationshiptype IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_contact_point_rec.attribute7 := l_cliente_rec.relationshiptype;                                                                                                                                                                                                                                                                                                                                                                                                                                           
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.isblacklisted IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        l_contact_point_rec.attribute8 := l_cliente_rec.isblacklisted;                                                                                                                                                                                                                                                                                                                                                                                                                                              
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    ----------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- incluido por Altair Costa em 23 de Junho de 2009                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    ----------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    IF l_endereco_tbl.COUNT = 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      --Cristiano Carvalho - GPTI - 13-Jul-2009                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      IF l_cliente_rec.email IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        l_cust_account_rec.attribute3 := l_cliente_rec.email;                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.brandinfo.brandid IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_cust_account_rec.attribute5 := l_cliente_rec.brandinfo.brandid;                                                                                                                                                                                                                                                                                                                                                                                                                                           
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /* IF l_cliente_rec.brandinfo.LOCATION IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         l_cust_account_rec.attribute5 := l_cliente_rec.brandinfo.LOCATION;                                                                                                                                                                                                                                                                                                                                                                                                                                         
       END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.gender = 'F' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_cust_account_rec.customer_class_code := 'FEMININO';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF l_cliente_rec.gender = 'M' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
          l_cust_account_rec.customer_class_code := 'MASCULINO';                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_cust_account_rec.customer_class_code := 'OUTROS';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.birthdate IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        l_cust_account_rec.attribute1 := to_char(to_date(substr(l_cliente_rec.birthdate, 1, 10), 'yyyy-mm-dd'), 'dd/mm/yyyy');                                                                                                                                                                                                                                                                                                                                                                                      
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.nickname IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        l_cust_account_rec.attribute6 := l_cliente_rec.nickname;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.relationshiptype IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_cust_account_rec.attribute7 := l_cliente_rec.relationshiptype;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.isblacklisted IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        l_cust_account_rec.attribute8 := l_cliente_rec.isblacklisted;                                                                                                                                                                                                                                                                                                                                                                                                                                               
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF l_cliente_rec.optlnlist.COUNT > 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        l_cust_account_rec.attribute9 := l_cliente_rec.optlnlist(1).key_s;                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        IF upper(l_cliente_rec.optlnlist(1).enabled) = 'TRUE' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                  
          l_cust_account_rec.attribute10 := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_cust_account_rec.attribute10 := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_cust_account_rec.cust_account_id := v_customer_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      l_cust_account_rec.attribute11     := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      hz_cust_account_v2pub.update_cust_account(p_init_msg_list => fnd_api.g_true, p_cust_account_rec => l_cust_account_rec, p_object_version_number => p_object_version_number, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                                         
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_v2pub.update_cust_account ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                     
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    ----------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    l_contact_point_rec.contact_point_id := v_contact_point_id_phone;                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_contact_point_rec.attribute1       := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    FOR k IN 1 .. l_cliente_rec.phonelist.COUNT LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      IF l_cliente_rec.phonelist(k).countrycode IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          SELECT contact_point_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                ,object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                ,nvl(phone_country_code, 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                ,nvl(phone_number, 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                ,nvl(phone_area_code, 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                ,nvl(phone_extension, 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            INTO v_contact_point_id_phone                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                ,cp_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                ,l_country                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                ,l_telefone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                ,l_areacode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                ,l_ramal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            FROM hz_contact_points                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
           WHERE owner_table_id = v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
             AND owner_table_name = 'HZ_PARTIES'                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
             AND contact_point_type = 'PHONE'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
             AND phone_line_type = l_cliente_rec.phonelist(k).type_s                                                                                                                                                                                                                                                                                                                                                                                                                                                
             AND status = 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          -- AND rownum = 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          WHEN no_data_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
            v_contact_point_id_phone := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
            x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
            x_desc_erro := 'Existem mais de um telefone ativo para o mesmo tipo.';                                                                                                                                                                                                                                                                                                                                                                                                                                  
            ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
        END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        --   l_contact_point_rec.contact_point_type    := 'PHONE';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        --   l_contact_point_rec.owner_table_name      := 'HZ_PARTIES';                                                                                                                                                                                                                                                                                                                                                                                                                                             
        --   l_contact_point_rec.owner_table_id        := v_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                               
        IF v_contact_point_id_phone IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          IF nvl(l_cliente_rec.phonelist(k).countrycode, 0) = l_country                                                                                                                                                                                                                                                                                                                                                                                                                                             
             AND nvl(l_cliente_rec.phonelist(k).areacode, 0) = l_areacode                                                                                                                                                                                                                                                                                                                                                                                                                                           
             AND nvl(l_cliente_rec.phonelist(k).number_p, 0) = l_telefone                                                                                                                                                                                                                                                                                                                                                                                                                                           
             AND nvl(l_cliente_rec.phonelist(k).extension, 0) = l_ramal THEN                                                                                                                                                                                                                                                                                                                                                                                                                                        
            -- não faz absolutamente nada e vai embora.                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            -- Cria um novo telefone e inativa o anterior                                                                                                                                                                                                                                                                                                                                                                                                                                                           
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_contact_point_rec.contact_point_id      := fnd_api.g_miss_num;                                                                                                                                                                                                                                                                                                                                                                                                                                        
            l_contact_point_rec.orig_system_reference := l_cliente_rec.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                  
            l_contact_point_rec.contact_point_type    := 'PHONE';                                                                                                                                                                                                                                                                                                                                                                                                                                                   
            l_contact_point_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
            l_contact_point_rec.owner_table_name      := 'HZ_PARTIES';                                                                                                                                                                                                                                                                                                                                                                                                                                              
            l_contact_point_rec.owner_table_id        := v_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                
            l_contact_point_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                        
            l_contact_point_rec.primary_flag          := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
            l_phone_rec.phone_country_code            := l_cliente_rec.phonelist(k).countrycode;                                                                                                                                                                                                                                                                                                                                                                                                                    
            l_phone_rec.phone_area_code               := l_cliente_rec.phonelist(k).areacode;                                                                                                                                                                                                                                                                                                                                                                                                                       
            l_phone_rec.phone_number                  := l_cliente_rec.phonelist(k).number_p;                                                                                                                                                                                                                                                                                                                                                                                                                       
            l_phone_rec.phone_extension               := l_cliente_rec.phonelist(k).extension;                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_phone_rec.phone_line_type               := l_cliente_rec.phonelist(k).type_s;                                                                                                                                                                                                                                                                                                                                                                                                                         
            hz_contact_point_v2pub.create_phone_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_phone_rec => l_phone_rec, x_contact_point_id => x_contact_point_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                  
              IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                  x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                          
                  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                  l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                          
                END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                x_desc_erro := 'Erro ao executar a api hz_contact_point_v2pub.create_contact_point ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                             
                ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            -- inativa o telefone anterior                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_contact_point_rec                  := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
            l_phone_rec                          := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
            l_contact_point_rec.contact_point_id := v_contact_point_id_phone;                                                                                                                                                                                                                                                                                                                                                                                                                                       
            l_contact_point_rec.status           := 'I';                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            hz_contact_point_v2pub.update_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_edi_rec => l_edi_rec, p_email_rec => l_email_rec, p_phone_rec => l_phone_rec, p_telex_rec => l_telex_rec, p_web_rec => l_web_rec, p_object_version_number => cp_object_version_number, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                  
              IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                  x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                          
                  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                  l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                          
                END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                x_desc_erro := 'Erro ao executar a api hz_contact_point_v2pub.update_contact_point ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                             
                ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          ---Dados de telefone do cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_contact_point_rec.contact_point_id      := fnd_api.g_miss_num;                                                                                                                                                                                                                                                                                                                                                                                                                                          
          l_contact_point_rec.orig_system_reference := l_cliente_rec.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                    
          l_contact_point_rec.contact_point_type    := 'PHONE';                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          l_contact_point_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_contact_point_rec.owner_table_name      := 'HZ_PARTIES';                                                                                                                                                                                                                                                                                                                                                                                                                                                
          l_contact_point_rec.owner_table_id        := v_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                  
          l_contact_point_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                          
          l_contact_point_rec.primary_flag          := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_phone_rec.phone_country_code            := l_cliente_rec.phonelist(k).countrycode;                                                                                                                                                                                                                                                                                                                                                                                                                      
          l_phone_rec.phone_area_code               := l_cliente_rec.phonelist(k).areacode;                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_phone_rec.phone_number                  := l_cliente_rec.phonelist(k).number_p;                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_phone_rec.phone_extension               := l_cliente_rec.phonelist(k).extension;                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_phone_rec.phone_line_type               := l_cliente_rec.phonelist(k).type_s;                                                                                                                                                                                                                                                                                                                                                                                                                           
          hz_contact_point_v2pub.create_phone_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_phone_rec => l_phone_rec, x_contact_point_id => x_contact_point_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
              FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                            
                --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                            
              END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
              x_desc_erro := 'Erro ao executar a api hz_contact_point_v2pub.create_contact_point ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                               
              ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    ----------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- E-MAIL  PODE SER ALTERADO -- LEANDRO 05/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- Atualiza o email do cliente - update_contact_point                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    IF l_cliente_rec.email IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_contact_point_rec.contact_point_type := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      -- D2 - Pegar os campos contact_point_id e object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                              
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SELECT contact_point_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              ,object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
              ,email_address                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          INTO v_contact_point_id_mail                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
              ,ce_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              ,l_email                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          FROM hz_contact_points a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
         WHERE owner_table_id = v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
           AND owner_table_name = 'HZ_PARTIES'                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
           AND contact_point_type = 'EMAIL'                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
           AND status = 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        -- AND ROWNUM = 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN no_data_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          v_contact_point_id_mail := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
          x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Existem mais de um endereço de email ativo para o mesmo tipo.';                                                                                                                                                                                                                                                                                                                                                                                                                           
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_contact_point_rec := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF v_contact_point_id_mail IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        IF l_email = l_cliente_rec.email THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          -- não faz absolutamente nada e vai embora.                                                                                                                                                                                                                                                                                                                                                                                                                                                               
          NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          ---Dados de email do cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_email_rec.email_address                 := l_cliente_rec.email;                                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_contact_point_rec.contact_point_id      := fnd_api.g_miss_num;                                                                                                                                                                                                                                                                                                                                                                                                                                          
          l_contact_point_rec.orig_system_reference := l_cliente_rec.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                    
          l_contact_point_rec.contact_point_type    := 'EMAIL';                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          l_contact_point_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_contact_point_rec.owner_table_name      := 'HZ_PARTIES';                                                                                                                                                                                                                                                                                                                                                                                                                                                
          l_contact_point_rec.owner_table_id        := v_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                  
          l_contact_point_rec.primary_flag          := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_email_rec.email_format                  := 'MAILHTML';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
          l_contact_point_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                          
          l_contact_point_rec.primary_by_purpose    := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          l_contact_point_rec.attribute1            := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          hz_contact_point_v2pub.create_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_edi_rec => l_edi_rec, p_email_rec => l_email_rec, p_phone_rec => l_phone_rec, p_telex_rec => l_telex_rec, p_web_rec => l_web_rec, x_contact_point_id => x_contact_point_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
              --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                            
                --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                            
                --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
              END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
              x_desc_erro := 'Erro ao executar a api  hz_contact_point_v2pub.create_contact_point (mail) ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                       
              ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
              --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          -- Inativar o email antigo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          l_contact_point_rec                  := NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
          l_contact_point_rec.contact_point_id := v_contact_point_id_mail;                                                                                                                                                                                                                                                                                                                                                                                                                                          
          l_contact_point_rec.status           := 'I';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          l_contact_point_rec.attribute1       := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          hz_contact_point_v2pub.update_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_edi_rec => p_edi_rec, p_email_rec => p_email_rec, p_phone_rec => p_phone_rec, p_telex_rec => p_telex_rec, p_web_rec => p_web_rec, p_object_version_number => ce_object_version_number, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
              --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                            
                --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                            
                --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
              END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
              x_desc_erro := l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
              ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
              --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        ---Dados de email do cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_email_rec.email_address                 := l_cliente_rec.email;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_contact_point_rec.contact_point_id      := fnd_api.g_miss_num;                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_contact_point_rec.orig_system_reference := l_cliente_rec.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                      
        l_contact_point_rec.contact_point_type    := 'EMAIL';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        l_contact_point_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_contact_point_rec.owner_table_name      := 'HZ_PARTIES';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        l_contact_point_rec.owner_table_id        := v_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        l_contact_point_rec.primary_flag          := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_email_rec.email_format                  := 'MAILHTML';                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        l_contact_point_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_contact_point_rec.primary_by_purpose    := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_contact_point_rec.attribute1            := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        hz_contact_point_v2pub.create_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_edi_rec => l_edi_rec, p_email_rec => l_email_rec, p_phone_rec => l_phone_rec, p_telex_rec => l_telex_rec, p_web_rec => l_web_rec, x_contact_point_id => x_contact_point_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                              
              --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                              
              --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
            x_desc_erro := 'Erro ao executar a api  hz_contact_point_v2pub.create_contact_point (mail) ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                         
            ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    x_cod_erro  := 'S';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    x_desc_erro := 'SUCCESS';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      x_desc_erro := 'B2W_API_CLIENTE.b2w_altera_cliente' || x_msg_data || ' ' || SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                          
  END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- INATIVA ENDEREÇO DE CLIENTES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE b2w_inativa_endereco                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    x_desc_erro OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,x_cod_erro  OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,id_cliente  IN VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
   ,id_endereco IN VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
   ,p_usuario   IN VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  ) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_party_id              NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    v_party_site_id         NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    v_cust_acct_site_id     NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    v_site_use_id           NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    x_msg_count             NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    x_msg_data              VARCHAR2(2000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    x_return_status         VARCHAR2(1);                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    p_object_version_number NUMBER := 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    l_party_site_rec        hz_party_site_v2pub.party_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                
    l_cust_site_use_rec     hz_cust_account_site_v2pub.cust_site_use_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                      
    v_location_id           hz_locations.location_id%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    l_msg_data_out          VARCHAR2(3000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    b2w_set_apps_initialize.b2w_set_apps_initialize('OM', '');                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- **********************************************************                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- **********************************************************                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- AS LINHAS ABAIXO FORA INIBIDAS A PEDIDO DO JEAN ATÉ SEGUNDA ORDEM FICARÁ DESABILITADO A                                                                                                                                                                                                                                                                                                                                                                                                                      
    -- INATIVAÇÃO DE ENDEREÇO - EM 26/01/2009 - POR ALTAIR COSTA                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- V1 - Pegar os campos party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    /*IF id_cliente IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          SELECT party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
            INTO v_party_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
            FROM hz_cust_accounts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
           WHERE orig_system_reference = id_cliente;                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                   'B2W_API_CLIENTE.b2w_inativa_endereco'                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                || ' - não encontrou a busca na tabela hz_cust_accounts.';                                                                                                                                                                                                                                                                                                                                                                                                                                          
       END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- V2 e D2- Pegar os campos location_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    IF id_endereco IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          SELECT location_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
            INTO v_location_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            FROM hz_locations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
           WHERE orig_system_reference = id_endereco;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                   'B2W_API_CLIENTE.b2w_inativa_endereco'                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                || ' - não encontrou a busca na tabela hz_locations.';                                                                                                                                                                                                                                                                                                                                                                                                                                              
       END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       -- D2- Pegar os campos party_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          SELECT party_site_id, object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                               
            -- faltava. ja corrigi - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                             
          INTO   v_party_site_id, p_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                           
            -- faltava. ja corrigi - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                             
          FROM   hz_party_sites                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
           WHERE location_id = v_location_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                   'B2W_API_CLIENTE.b2w_inativa_endereco'                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                || ' - não encontrou a busca na tabela hz_party_sites.';                                                                                                                                                                                                                                                                                                                                                                                                                                            
       END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_party_site_rec.party_site_id := v_party_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_party_site_rec.status := 'I';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    --      l_party_site_rec.attribute6 := user_name;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    hz_party_site_v2pub.update_party_site                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                        (p_init_msg_list              => fnd_api.g_true,                                                                                                                                                                                                                                                                                                                                                                                                                                            
                         p_party_site_rec             => l_party_site_rec,                                                                                                                                                                                                                                                                                                                                                                                                                                          
                         p_object_version_number      => p_object_version_number,                                                                                                                                                                                                                                                                                                                                                                                                                                   
                         x_return_status              => x_return_status,                                                                                                                                                                                                                                                                                                                                                                                                                                           
                         x_msg_count                  => x_msg_count,                                                                                                                                                                                                                                                                                                                                                                                                                                               
                         x_msg_data                   => x_msg_data                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                        );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF (x_return_status != fnd_api.g_ret_sts_success)                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       IF (x_msg_count > 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
          LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_msg_data :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                 fnd_msg_pub.get (p_msg_index      => l_index,                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                  p_encoded        => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                                         
             --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                               
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                'Erro ao executar a api hz_contact_point_v2pub.update_contact_point '                                                                                                                                                                                                                                                                                                                                                                                                                               
             || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                               
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- D3- Pegar os campos cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       SELECT cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
         INTO v_cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
         FROM hz_cust_acct_sites_all                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        WHERE party_site_id = v_party_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                'B2W_API_CLIENTE.b2w_inativa_endereco'                                                                                                                                                                                                                                                                                                                                                                                                                                                              
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                          
             || ' - não encontrou a busca na tabela hz_cust_acct_sites_all.'                                                                                                                                                                                                                                                                                                                                                                                                                                        
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || UTL_HTTP.get_detailed_sqlerrm;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --   UTL_HTTP.end_response (v_http_response);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- D3- Pegar os campos site_use_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       SELECT site_use_id, object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
         -- faltava. ja corrigi - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       INTO   v_site_use_id, p_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                
         -- faltava. ja corrigi - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       FROM   hz_cust_site_uses_all                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
        WHERE cust_acct_site_id = v_cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                               
          AND site_use_code = 'BILL_TO';                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    --            AND status = 'A'; LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                'B2W_API_CLIENTE.b2w_inativa_endereco'                                                                                                                                                                                                                                                                                                                                                                                                                                                              
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                          
             || ' - não encontrou a busca na tabela hz_cust_site_uses_all.'                                                                                                                                                                                                                                                                                                                                                                                                                                         
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || UTL_HTTP.get_detailed_sqlerrm;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    --  UTL_HTTP.end_response (v_http_response);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_site_use_rec.site_use_id := v_site_use_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_cust_site_use_rec.status := 'I';                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    hz_cust_account_site_v2pub.update_cust_site_use                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                        (p_init_msg_list              => fnd_api.g_true,                                                                                                                                                                                                                                                                                                                                                                                                                                            
                         p_cust_site_use_rec          => l_cust_site_use_rec,                                                                                                                                                                                                                                                                                                                                                                                                                                       
                         p_object_version_number      => p_object_version_number,                                                                                                                                                                                                                                                                                                                                                                                                                                   
                         x_return_status              => x_return_status,                                                                                                                                                                                                                                                                                                                                                                                                                                           
                         x_msg_count                  => x_msg_count,                                                                                                                                                                                                                                                                                                                                                                                                                                               
                         x_msg_data                   => x_msg_data                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                        );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF (x_return_status != fnd_api.g_ret_sts_success)                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       IF (x_msg_count > 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
          LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_msg_data :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                 fnd_msg_pub.get (p_msg_index      => l_index,                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                  p_encoded        => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                                         
             --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                               
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                'Erro ao executar a api hz_cust_account_site_v2pub.update_cust_site_use '                                                                                                                                                                                                                                                                                                                                                                                                                           
             || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                               
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- D4- Pegar os campos cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- Inativar endereço de entrega                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       SELECT cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
         INTO v_cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
         FROM hz_cust_acct_sites_all                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        WHERE party_site_id = v_party_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                'B2W_API_CLIENTE.b2w_inativa_endereco'                                                                                                                                                                                                                                                                                                                                                                                                                                                              
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                          
             || ' - não encontrou a busca na tabela hz_cust_acct_sites_all.'                                                                                                                                                                                                                                                                                                                                                                                                                                        
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || UTL_HTTP.get_detailed_sqlerrm;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --   UTL_HTTP.end_response (v_http_response);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- D4- Pegar os campos site_use_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       SELECT site_use_id, object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
         -- faltava. ja corrigi - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       INTO   v_site_use_id, p_object_version_number                                                                                                                                                                                                                                                                                                                                                                                                                                                                
         -- faltava. ja corrigi - LEANDRO 01/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       FROM   hz_cust_site_uses_all                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
        WHERE cust_acct_site_id = v_cust_acct_site_id                                                                                                                                                                                                                                                                                                                                                                                                                                                               
          AND site_use_code = 'SHIP_TO';                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    --            AND status = 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHEN NO_DATA_FOUND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                'B2W_API_CLIENTE.b2w_inativa_endereco'                                                                                                                                                                                                                                                                                                                                                                                                                                                              
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || TO_CHAR (SYSDATE, 'dd-mm-yyyy hh24:mi:ss')                                                                                                                                                                                                                                                                                                                                                                                                                                                          
             || ' - não encontrou a busca na tabela hz_cust_site_uses_all.'                                                                                                                                                                                                                                                                                                                                                                                                                                         
             || ' - '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
             || UTL_HTTP.get_detailed_sqlerrm;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --   UTL_HTTP.end_response (v_http_response);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_site_use_rec.site_use_id := v_site_use_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_cust_site_use_rec.status := 'I';                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    hz_cust_account_site_v2pub.update_cust_site_use                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                        (p_init_msg_list              => fnd_api.g_true,                                                                                                                                                                                                                                                                                                                                                                                                                                            
                         p_cust_site_use_rec          => l_cust_site_use_rec,                                                                                                                                                                                                                                                                                                                                                                                                                                       
                         p_object_version_number      => p_object_version_number,                                                                                                                                                                                                                                                                                                                                                                                                                                   
                         x_return_status              => x_return_status,                                                                                                                                                                                                                                                                                                                                                                                                                                           
                         x_msg_count                  => x_msg_count,                                                                                                                                                                                                                                                                                                                                                                                                                                               
                         x_msg_data                   => x_msg_data                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                        );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF (x_return_status != fnd_api.g_ret_sts_success)                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       IF (x_msg_count > 0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
          LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_msg_data :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                 fnd_msg_pub.get (p_msg_index      => l_index,                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                  p_encoded        => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                                         
             --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                               
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                'Erro ao executar a api hz_cust_account_site_v2pub.update_cust_site_use '                                                                                                                                                                                                                                                                                                                                                                                                                           
             || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
       --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                               
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    x_cod_erro  := 'S';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    x_desc_erro := 'SUCCESS';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      x_cod_erro  := x_return_status;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      x_desc_erro := 'B2W_API_CLIENTE.b2w_inativa_endereco' || x_msg_data || SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                               
      --         UTL_HTTP.end_response (v_http_response);                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                         
  PROCEDURE b2w_insere_cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    x_desc_erro OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,x_cod_erro  OUT VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
   ,pa_cliente  IN b2wcustomer.customer_tbl                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
   ,p_usuario   IN VARCHAR2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  ) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --v_http_response     utl_http.resp;                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    p_create_profile    VARCHAR2(1) := fnd_api.g_true;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    x_contact_point_id  NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    x_site_use_id       NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    x_cust_acct_site_id NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    x_party_site_id     NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    x_party_site_number VARCHAR2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    x_location_id       NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    -- variaveis para criação de cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    p_create_profile_amt   VARCHAR2(1) := fnd_api.g_true;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    x_cust_account_id      NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_account_number       VARCHAR2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    x_party_id             NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_party_number         VARCHAR2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    x_profile_id           NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_return_status        VARCHAR2(1);                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    x_msg_count            NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    x_msg_data             VARCHAR2(2000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    l_msg_data_out         VARCHAR2(3000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    l_person_rec           hz_party_v2pub.person_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    l_organization_rec     hz_party_v2pub.organization_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_account_rec     hz_cust_account_v2pub.cust_account_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                             
    l_customer_profile_rec hz_customer_profile_v2pub.customer_profile_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                     
    l_cust_acct_site_rec   hz_cust_account_site_v2pub.cust_acct_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                      
    l_cust_site_use_rec    hz_cust_account_site_v2pub.cust_site_use_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                       
    l_party_site_rec       hz_party_site_v2pub.party_site_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    l_location_rec         hz_location_v2pub.location_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    l_contact_point_rec    hz_contact_point_v2pub.contact_point_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                           
    l_email_rec            hz_contact_point_v2pub.email_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    l_phone_rec            hz_contact_point_v2pub.phone_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    l_edi_rec              hz_contact_point_v2pub.edi_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    l_telex_rec            hz_contact_point_v2pub.telex_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    l_web_rec              hz_contact_point_v2pub.web_rec_type;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    p_cliente              b2wcustomer.customer;                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    v_conta_cliente        NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    b2w_set_apps_initialize.b2w_set_apps_initialize('OM', '');                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    p_cliente := pa_cliente(1);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Validar Dados de Entrada                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    IF p_cliente.type_s IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Tipo de cliente está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                              
      RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- V1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    IF p_cliente.type_s = 'J' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      IF p_cliente.gender IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, quando o cliente for pessoa jurídica o campo Sexo não deve ser preenchido.';                                                                                                                                                                                                                                                                                                                                                                            
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_cliente.birthdate IS NOT NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, quando o cliente for pessoa jurídica o campo Data de Nascimento não deve ser preenchido.';                                                                                                                                                                                                                                                                                                                                                              
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
               IF p_cliente.nickname IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
               THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                  x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                  x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                     'b2w_api_cliente.b2w_insere_cliente, quando o cliente for pessoa jurídica o campo Apelido não deve ser preenchido.';                                                                                                                                                                                                                                                                                                                                                                           
                  RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
               END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF p_cliente.customerid IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Identificador do cliente está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                     
      RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      SELECT COUNT(customer_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        INTO v_conta_cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        FROM ra_customers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       WHERE orig_system_reference = p_cliente.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF v_conta_cliente > 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'B2W_API_CLIENTE.b2w_insere_cliente' || ' - ' || to_char(SYSDATE, 'dd-mm-yyyy hh24:mi:ss') || ' -cliente ' ||                                                                                                                                                                                                                                                                                                                                                                                
                       p_cliente.customerid || ' - ' || 'ja existe';                                                                                                                                                                                                                                                                                                                                                                                                                                                
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF p_cliente.name_s IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Nome está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                         
      RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          IF p_cliente.email IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                          'b2w_api_cliente.b2w_insere_cliente, E-mail está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                  
             RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    IF p_cliente.brandinfo.brandid IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Identificador da marca do pedido está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                             
      RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          IF p_cliente.brandinfo.LOCATION IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                'b2w_api_cliente.b2w_insere_cliente, Identificador da marca do pedido está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                  
             RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    IF p_cliente.documentnumber IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, CPF/CNPJ está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                                     
      RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    FOR i IN 1 .. p_cliente.addresslist.COUNT LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_cliente.addresslist(i).addressid IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Identificador do endereço do cliente no site está nulo.';                                                                                                                                                                                                                                                                                                                                                                                               
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        DECLARE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          l_endereco_existe NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          SELECT COUNT(1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
            INTO l_endereco_existe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
            FROM hz_cust_acct_sites                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
           WHERE orig_system_reference = p_cliente.addresslist(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                        
          IF l_endereco_existe > 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
            x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Endereço ' || p_cliente.addresslist(i).addressid || ' já cadastrado';                                                                                                                                                                                                                                                                                                                                                                               
            RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_cliente.addresslist(i).address IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        x_cod_erro  := 'W';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Endereço do cliente está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                                        
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    /*IF p_cliente.addresslist (i).number_p IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                             THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                x_cod_erro := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                x_desc_erro :=                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                   'b2w_api_cliente.b2w_insere_cliente, Nr. do endereço do cliente está nulo.';                                                                                                                                                                                                                                                                                                                                                                                                     
                                RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
              END IF;*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    ---Insere dados de cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_cust_account_rec.orig_system_reference := p_cliente.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_cust_account_rec.attribute3            := p_cliente.email;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_account_rec.attribute5            := p_cliente.brandinfo.brandid;                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --  l_cust_account_rec.attribute5 := p_cliente.brandinfo.LOCATION;                                                                                                                                                                                                                                                                                                                                                                                                                                              
    IF p_cliente.gender = 'F' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_cust_account_rec.customer_class_code := 'FEMININO';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      IF p_cliente.gender = 'M' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        l_cust_account_rec.customer_class_code := 'MASCULINO';                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_account_rec.customer_class_code := 'OUTROS';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_account_rec.attribute1 := to_char(to_date(substr(p_cliente.birthdate, 1, 10), 'yyyy-mm-dd'), 'dd/mm/yyyy');                                                                                                                                                                                                                                                                                                                                                                                              
    l_cust_account_rec.attribute6 := p_cliente.nickname;                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    l_cust_account_rec.attribute7 := p_cliente.relationshiptype;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_account_rec.attribute2 := p_cliente.documentnumber;                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF p_cliente.type_s = 'F' -- &&                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
     THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      l_cust_account_rec.global_attribute2 := '1';                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_cust_account_rec.global_attribute3 := substr(p_cliente.documentnumber, 0, 9);                                                                                                                                                                                                                                                                                                                                                                                                                               
      l_cust_account_rec.global_attribute4 := '0000';                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      l_cust_account_rec.global_attribute5 := substr(p_cliente.documentnumber, length(p_cliente.documentnumber) - 1, 2);                                                                                                                                                                                                                                                                                                                                                                                            
    ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_account_rec.global_attribute2 := '2';                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_cust_account_rec.global_attribute3 := substr(p_cliente.documentnumber, 0, 8);                                                                                                                                                                                                                                                                                                                                                                                                                               
      l_cust_account_rec.global_attribute4 := substr(p_cliente.documentnumber, 9, 4);                                                                                                                                                                                                                                                                                                                                                                                                                               
      l_cust_account_rec.global_attribute5 := substr(p_cliente.documentnumber, 13, 2);                                                                                                                                                                                                                                                                                                                                                                                                                              
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_cust_account_rec.status        := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    l_cust_account_rec.customer_type := 'R';                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    --l_cust_account_rec.org_id := 103;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    l_cust_account_rec.created_by_module := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    l_cust_account_rec.attribute11       := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_cust_account_rec.attribute19       := '0';                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF p_cliente.type_s = 'F' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_person_rec.person_last_name     := p_cliente.name_s; -- FC 04/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_person_rec.person_name_phonetic := p_cliente.nickname;                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_cust_account_rec.attribute12    := to_char(to_date((substr(p_cliente.creationdate, 1, 10) || ' ' || substr(p_cliente.creationdate, 12, 8)), 'yyyy-mm-dd hh24:mi:ss'), 'dd/mm/yyyy hh24:mi:ss');                                                                                                                                                                                                                                                                                                             
      -- LEANDRO 02/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_organization_rec.organization_name := p_cliente.name_s;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    l_organization_rec.created_by_module := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF p_cliente.optlnlist.COUNT > 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      -- Trabalha com a primeira ocorrencia, no futuro vai ser definido uma tabela para trabalhar com varias ocor                                                                                                                                                                                                                                                                                                                                                                                                   
      l_cust_account_rec.attribute9 := p_cliente.optlnlist(1).key_s;                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF upper(p_cliente.optlnlist(1).enabled) = 'TRUE' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        l_cust_account_rec.attribute10 := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_account_rec.attribute10 := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- LEANDRO 02/07/2008                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    -- PF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    IF p_cliente.type_s = 'F' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      hz_cust_account_v2pub.create_cust_account(p_init_msg_list => fnd_api.g_true, p_cust_account_rec => l_cust_account_rec, p_person_rec => l_person_rec, -- PF                                                                                                                                                                                                                                                                                                                                                    
                                                p_customer_profile_rec => l_customer_profile_rec, p_create_profile_amt => p_create_profile_amt, x_cust_account_id => x_cust_account_id, x_account_number => x_account_number, x_party_id => x_party_id, x_party_number => x_party_number, x_profile_id => x_profile_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                  
      -- PJ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      hz_cust_account_v2pub.create_cust_account(p_init_msg_list => fnd_api.g_true, p_cust_account_rec => l_cust_account_rec, p_organization_rec => l_organization_rec,                                                                                                                                                                                                                                                                                                                                              
                                                -- PJ                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                p_customer_profile_rec => l_customer_profile_rec, p_create_profile_amt => p_create_profile_amt, x_cust_account_id => x_cust_account_id, x_account_number => x_account_number, x_party_id => x_party_id, x_party_number => x_party_number, x_profile_id => x_profile_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                  
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                  
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'Erro ao executar a api hz_cust_account_v2pub.create_cust_account ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                       
        ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    ---Dados de endereço do cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_location_rec.created_by_module := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    l_location_rec.attribute7        := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    FOR i IN 1 .. p_cliente.addresslist.COUNT LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      IF p_cliente.addresslist(i).addressid IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'b2w_api_cliente.b2w_insere_cliente, Identificador do endereço do cliente no site está nulo.';                                                                                                                                                                                                                                                                                                                                                                                               
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_location_rec.orig_system_reference := p_cliente.addresslist(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                                   
      l_location_rec.address1              := p_cliente.addresslist(i).address;                                                                                                                                                                                                                                                                                                                                                                                                                                     
      l_location_rec.address4              := p_cliente.addresslist(i).number_p;                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_location_rec.province              := p_cliente.addresslist(i).additionalinfo;                                                                                                                                                                                                                                                                                                                                                                                                                              
      l_location_rec.address2              := p_cliente.addresslist(i).quarter;                                                                                                                                                                                                                                                                                                                                                                                                                                     
      l_location_rec.city                  := p_cliente.addresslist(i).city;                                                                                                                                                                                                                                                                                                                                                                                                                                        
      l_location_rec.state                 := p_cliente.addresslist(i).state;                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_location_rec.address3              := p_cliente.addresslist(i).country;                                                                                                                                                                                                                                                                                                                                                                                                                                     
      l_location_rec.country               := p_cliente.addresslist(i).country;                                                                                                                                                                                                                                                                                                                                                                                                                                     
      l_location_rec.postal_code           := p_cliente.addresslist(i).postalcode;                                                                                                                                                                                                                                                                                                                                                                                                                                  
      l_location_rec.attribute5            := p_cliente.addresslist(i).reference_p;                                                                                                                                                                                                                                                                                                                                                                                                                                 
      l_location_rec.attribute6            := p_cliente.addresslist(i).contactname;                                                                                                                                                                                                                                                                                                                                                                                                                                 
      l_location_rec.attribute8            := to_char(to_date((substr(p_cliente.addresslist(i).creationdate, 1, 10) || ' ' ||                                                                                                                                                                                                                                                                                                                                                                                       
                                                              substr(p_cliente.addresslist(i).creationdate, 12, 8)), 'yyyy-mm-dd hh24:mi:ss'), 'dd/mm/yyyy hh24:mi:ss');                                                                                                                                                                                                                                                                                                                                            
      -- l_location_rec.attribute19           := p_cliente.addresslist(i).siteaddressid;                                                                                                                                                                                                                                                                                                                                                                                                                            
      hz_location_v2pub.create_location(p_init_msg_list => fnd_api.g_true, p_location_rec => l_location_rec, x_location_id => x_location_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_location_v2pub.create_location ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                             
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      ---Para associar cliente e endereço                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_party_site_rec.orig_system_reference    := p_cliente.addresslist(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                              
      l_party_site_rec.party_id                 := x_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_party_site_rec.location_id              := x_location_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      l_party_site_rec.identifying_address_flag := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_party_site_rec.created_by_module        := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                              
      l_party_site_rec.status                   := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- l_party_site_rec.attribute19              := p_cliente.addresslist(i).siteaddressid;                                                                                                                                                                                                                                                                                                                                                                                                                       
      hz_party_site_v2pub.create_party_site(p_init_msg_list => fnd_api.g_true, p_party_site_rec => l_party_site_rec, x_party_site_id => x_party_site_id, x_party_site_number => x_party_site_number, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_party_site_v2pub.create_party_site ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                         
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      ---Para Complementar Informaçoes do cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_acct_site_rec.orig_system_reference := p_cliente.addresslist(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_cliente.type_s = 'F' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        l_cust_acct_site_rec.global_attribute2 := '1';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        l_cust_acct_site_rec.global_attribute3 := substr(p_cliente.documentnumber, 0, 9);                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_cust_acct_site_rec.global_attribute4 := '0000';                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_cust_acct_site_rec.global_attribute5 := substr(p_cliente.documentnumber, length(p_cliente.documentnumber) - 1, 2);                                                                                                                                                                                                                                                                                                                                                                                        
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.global_attribute2 := '2';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        l_cust_acct_site_rec.global_attribute3 := substr(p_cliente.documentnumber, 0, 8);                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_cust_acct_site_rec.global_attribute4 := substr(p_cliente.documentnumber, 9, 4);                                                                                                                                                                                                                                                                                                                                                                                                                           
        l_cust_acct_site_rec.global_attribute5 := substr(p_cliente.documentnumber, 13, 2);                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_cliente.istaxpayer = 'S' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        l_cust_acct_site_rec.global_attribute8 := 'CONTRIBUINTE';                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.global_attribute8 := 'NCONTRIBUINTE';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_cust_acct_site_rec.global_attribute6 := p_cliente.stateinscription;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_cust_acct_site_rec.attribute8        := p_cliente.isblacklisted;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_acct_site_rec.attribute12       := to_char(to_date((substr(p_cliente.creationdate, 1, 10) || ' ' ||                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                substr(p_cliente.creationdate, 12, 8)), 'yyyy-mm-dd hh24:mi:ss'), 'dd/mm/yyyy hh24:mi:ss');                                                                                                                                                                                                                                                                                                                                                         
      l_cust_acct_site_rec.status            := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      --   l_cust_acct_site_rec.org_id := 103;                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_cust_acct_site_rec.created_by_module := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF p_cliente.type_s = 'F' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        l_cust_acct_site_rec.global_attribute2 := '1';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        l_cust_acct_site_rec.global_attribute2 := '2';                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_cust_acct_site_rec.global_attribute_category := 'JL.BR.ARXCUDCI.Additional';                                                                                                                                                                                                                                                                                                                                                                                                                                
      l_cust_acct_site_rec.global_attribute9         := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      l_cust_acct_site_rec.attribute1                := 'RES';                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      l_cust_acct_site_rec.cust_account_id           := x_cust_account_id;                                                                                                                                                                                                                                                                                                                                                                                                                                          
      l_cust_acct_site_rec.party_site_id             := x_party_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_acct_site_rec.LANGUAGE                  := userenv('LANG');                                                                                                                                                                                                                                                                                                                                                                                                                                            
      hz_cust_account_site_v2pub.create_cust_acct_site(p_init_msg_list => fnd_api.g_true, p_cust_acct_site_rec => l_cust_acct_site_rec, x_cust_acct_site_id => x_cust_acct_site_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_site_v2pub.create_cust_acct_site ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                              
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      ---Complemento de endereço de faturamento                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_site_use_rec.orig_system_reference := p_cliente.addresslist(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                              
      l_cust_site_use_rec.cust_acct_site_id     := x_cust_acct_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.site_use_code         := 'BILL_TO';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_cust_site_use_rec.primary_flag          := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.location              := x_location_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      -- l_cust_site_use_rec.attribute19           := p_cliente.addresslist(i).siteaddressid;                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_cust_site_use_rec.created_by_module := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      hz_cust_account_site_v2pub.create_cust_site_use(p_init_msg_list => fnd_api.g_true, p_cust_site_use_rec => l_cust_site_use_rec, p_customer_profile_rec => l_customer_profile_rec, p_create_profile => p_create_profile, p_create_profile_amt => p_create_profile_amt, x_site_use_id => x_site_use_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_site_v2pub.create_cust_site_use (bill) ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                        
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      ---Complemento de endereço de entrega                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_cust_site_use_rec.orig_system_reference := p_cliente.addresslist(i).addressid;                                                                                                                                                                                                                                                                                                                                                                                                                              
      l_cust_site_use_rec.cust_acct_site_id     := x_cust_acct_site_id;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.site_use_code         := 'SHIP_TO';                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_cust_site_use_rec.primary_flag          := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      l_cust_site_use_rec.location              := x_location_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      -- l_cust_site_use_rec.attribute19           := p_cliente.addresslist(i).siteaddressid;                                                                                                                                                                                                                                                                                                                                                                                                                       
      l_cust_site_use_rec.created_by_module := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      hz_cust_account_site_v2pub.create_cust_site_use(p_init_msg_list => fnd_api.g_true, p_cust_site_use_rec => l_cust_site_use_rec, p_customer_profile_rec => l_customer_profile_rec, p_create_profile => p_create_profile, p_create_profile_amt => p_create_profile_amt, x_site_use_id => x_site_use_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar a api hz_cust_account_site_v2pub.create_cust_site_use (ship) ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                        
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    ---Dados de telefone do cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_contact_point_rec.orig_system_reference := p_cliente.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_contact_point_rec.contact_point_type    := 'PHONE';                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    l_contact_point_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_contact_point_rec.owner_table_name      := 'HZ_PARTIES';                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    l_contact_point_rec.owner_table_id        := x_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    l_contact_point_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                
    l_contact_point_rec.primary_by_purpose    := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    FOR i IN 1 .. p_cliente.phonelist.COUNT LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      l_phone_rec.phone_country_code := p_cliente.phonelist(i).countrycode;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      l_phone_rec.phone_area_code    := p_cliente.phonelist(i).areacode;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_phone_rec.phone_number       := p_cliente.phonelist(i).number_p;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      l_phone_rec.phone_extension    := p_cliente.phonelist(i).extension;                                                                                                                                                                                                                                                                                                                                                                                                                                           
      l_phone_rec.phone_line_type    := p_cliente.phonelist(i).type_s;                                                                                                                                                                                                                                                                                                                                                                                                                                              
      hz_contact_point_v2pub.create_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_edi_rec => l_edi_rec, p_email_rec => l_email_rec, p_phone_rec => l_phone_rec, p_telex_rec => l_telex_rec, p_web_rec => l_web_rec, x_contact_point_id => x_contact_point_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
            l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                
            --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
          END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
          x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          x_desc_erro := 'Erro ao executar api hz_contact_point_v2pub.create_contact_point (phone) ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                             
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
          RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    ---Dados de email do cliente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    IF p_cliente.email IS NULL THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      p_cliente.email := 'callcenter@shoptime.com';                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    l_email_rec.email_address                 := p_cliente.email;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    l_contact_point_rec.contact_point_type    := 'EMAIL';                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    l_contact_point_rec.status                := 'A';                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_contact_point_rec.owner_table_name      := 'HZ_PARTIES';                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    l_contact_point_rec.owner_table_id        := x_party_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    l_contact_point_rec.primary_flag          := 'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_contact_point_rec.orig_system_reference := p_cliente.customerid;                                                                                                                                                                                                                                                                                                                                                                                                                                              
    l_email_rec.email_format                  := 'MAILHTML';                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    l_contact_point_rec.created_by_module     := 'TCA_FORM_WRAPPER';                                                                                                                                                                                                                                                                                                                                                                                                                                                
    l_contact_point_rec.primary_by_purpose    := 'N';                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    l_contact_point_rec.attribute1            := p_usuario;                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    hz_contact_point_v2pub.create_contact_point(p_init_msg_list => fnd_api.g_true, p_contact_point_rec => l_contact_point_rec, p_edi_rec => l_edi_rec, p_email_rec => l_email_rec, p_phone_rec => l_phone_rec, p_telex_rec => l_telex_rec, p_web_rec => l_web_rec, x_contact_point_id => x_contact_point_id, x_return_status => x_return_status, x_msg_count => x_msg_count, x_msg_data => x_msg_data);                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    IF (x_return_status != fnd_api.g_ret_sts_success) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      IF (x_msg_count > 0) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        FOR l_index IN 1 .. x_msg_count LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          x_msg_data := fnd_msg_pub.get(p_msg_index => l_index, p_encoded => 'F');                                                                                                                                                                                                                                                                                                                                                                                                                                  
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          l_msg_data_out := l_msg_data_out || x_msg_data || ' / ';                                                                                                                                                                                                                                                                                                                                                                                                                                                  
          --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        x_cod_erro  := 'E';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        x_desc_erro := 'Erro ao executar a api  hz_contact_point_v2pub.create_contact_point (mail) ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                             
        ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        RETURN;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      --    x_desc_erro := 'PROCESS_ORDER Error..: ' || l_msg_data_out;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    x_cod_erro  := 'S';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    x_desc_erro := 'SUCCESS';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      x_cod_erro  := x_return_status;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      x_desc_erro := 'B2W_API_CLIENTE.b2w_insere_cliente' || x_msg_data || SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                                 
  END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  ------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                      
END b2w_api_cliente;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
SQL> spool off
